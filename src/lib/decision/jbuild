(jbuild_version 1)

;; generate menhir tokens
(rule
 ((targets (Tokens.ml))
  (deps    (Raw_parser.mly))
  (action  (run ${bin:menhir} --only-tokens ${<} --base Tokens))))

;; generate lexer -- temporary hack while ppx_import is incompatible with jbuilder!!
(rule
 ((targets (Lexer.ml))
  (deps    (Lexer.cppo.ml Tokens.ml))
  (action  (run ${bin:cppo} ${<} -n -o ${@}))))
(rule
 ((targets (Lexer.mli))
  (deps    (Lexer.cppo.mli Tokens.ml))
  (action  (run ${bin:cppo} ${<} -n -o ${@}))))

(menhir (
  (modules (Raw_parser))
  (flags (--external-tokens Lexer))
))

(library
 ((name        frenetic_decision)
  (public_name frenetic.decision)
  (wrapped true)
  (libraries 
    (core
     frenetic.netkat
     expect_test_helpers_kernel
    )
  )
  (inline_tests)
  (preprocess (pps (ppx_deriving.std
                    ppx_compare
                    ppx_hash
                    ppx_sexp_conv
                    sedlex.ppx
                    ppx_jane
                   )))
  (flags (:standard -safe-string))
 )
)
