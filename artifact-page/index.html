<html>

<head>
<link href="https://fonts.googleapis.com/css?family=Merriweather+Sans" rel="stylesheet">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link href="prism.css" rel="stylesheet" />
<style>
@import url('https://fonts.googleapis.com/css?family=Droid+Sans+Mono');
div.container {
  width: 1024px;
}
head, body {
  font-family: 'Merriweather Sans', sans-serif;
  background-color: #eeeeee;
}
header, footer {
  padding: 1em;
  color: black;
  background-color: #f1f3f5;
  clear: left;
  text-align: center;
}
header img {
  vertical-align: text-top;
}
nav {
  float: left;
  max-width: 200px;
  min-width: 200px;
  margin: 0;
  padding: 1em;
  background-color: #ffffff;
  border-right: 1px solid gray;
  position:fixed;
}
nav ul {
  list-style-type: none;
  padding: 0;
}
nav ul a {
  text-decoration: none;
}
article {
  margin-left: 200px;
  border-left: 1px solid gray;
  padding: 2em;
  overflow: hidden;
  background-color: #ffffff;
}

</style>
</head>

<body>

  <script src="prism.js"></script>
  <div class="container">

    <header>
      <h1>Scalable Verification of Probabilistic Networks</h1>
      <h1><img src="golden_arches.png" height="38px" alt="M"/>cNetKAT</h1>
      <h3>PLDI 2019</h3>
    </header>

    <nav>
      <ul>
        <!-- <li><a href="#downloads">Downloads</a></li> -->
        <li><a href="#platform">Experimental Platform</a></li>
        <li><a href="#installation">Installation</a>
          <ul>
            <li>&#8192;<a href="#vagrant">- Vagrant</a></li>
            <li>&#8192;<a href="#source">- Source</a></li>
          </ul>
        </li>
        <li><a href="#results">Replicating results</a>
          <ul>
            <li>&#8192;<a href="#evaluation">- Evaluation</a></li>
            <li>&#8192;<a href="#case-study">- Case Study</a></li>
          </ul>
        </li>
      </ul>
    </nav>

    <article>
    This webpage provides the instructions to build and install
    McNetKAT and reproduce the results from the paper "Scalable
    Verification of Probabilistic Networks" (to appear at PLDI 2019).
<!--       <div id="downloads">
        <h2>Downloads</h2>
        <ul>
          <li>Virtual Machine (VM) images: &nbsp <a
          href="https://drive.google.com/uc?id=1S10MF0Nzbh2C4-FYIWe4HPNGkafcXaEY&export=download">64-bit (6.0GB)</a> (username:
          <code>mcnetkat</code>, password:
          <code>mcnetkat</code>)</li>
          <li> Source: <a href="https://github.com/frenetic-lang/frenetic/tree/mc-decision">GitHub</a></li>
        </ul>
      </div>
      <hr/> -->
      <div id="platform">
        <h2>Experimental Platform</h2>
        We used a cluster of 24 Dell R620 servers, with each server
        having 2x Intel Xeon E5-2650 v2 processors and 64GB of RAM
        and running Ubuntu 16.04 (x86_64). While a cluster is
        needed for a few experiments, most of the
        experiments can be run with a single machine.
      </div>
      <hr/>
      <div id="installation">
        <h2>Installation</h2>
        There are two options for installing and testing McNetKAT:
<!--         <div id="vm">
          <h3><u>Pre-built virtual machine (recommended):</u></h3>
          <ol>
            <li>Download the pre-built VM image mentioned above.</li>
            <li>Start <a
            href="https://www.virtualbox.org/wiki/Downloads">VirtualBox</a>
            on your host machine.</li>
            <li>Import McNetKAT VM by selecting "File" ->
            "Import Appliance", and selecting the downloaded VM
            image.</li>

            <li>Allocate the VM as much RAM as possible (at
            least 4GB) and at least 2 processors.</li>

            <li>You may need to turn on virtualization
            extensions in your BIOS to enable 64-bit
            virtualization.</li>

            <li> When the VM starts up, the
            <code>mcnetkat</code> user should be automatically
            logged in. (username: <code>mcnetkat</code>,
            password: <code>mcnetkat</code>).</li>

            <li> The VM should have all the dependencies
            along with a version of McNetKAT pre-installed.
            Optionally, to get the latest version, perform:</li>

<pre><code class="language-bash">cd ~/frenetic
git pull && make && make install</code></pre>

          </ol>
        </div> -->

        <div id="vagrant">
          <h3><u>Using vagrant:</u></h3>
          <ol>
          <li> Install <a
          href="https://www.vagrantup.com/docs/installation/">vagrant</a>
          and
          <a href="https://www.virtualbox.org/wiki/Downloads">VirtualBox</a>.
          On Ubuntu, you can do this by executing <code>sudo apt
          install vagrant virtualbox</code>. On macOS, you can do
          this by executing <code>brew cask install virtualbox virtualbox-extension-pack && brew install vagrant</code> provided you have <a href="https://brew.sh/">homebrew</a> installed.

          <li>Get the source code with vagrant scripts:</li>
<pre><code class="language-bash">git clone -b mc-decision https://github.com/frenetic-lang/frenetic.git
cd frenetic/vm/ </code></pre>

          <li>Start the VM and ssh into it. This will
          automatically install all the dependencies and
          build and install McNetKAT in the VM, so it's time for a coffee break...</li>

<pre><code class="language-bash">vagrant up
vagrant ssh
cd frenetic</code></pre>
          </ol>
        </div>

        <div id="source">
          <h3><u>From source (requires Linux):</u></h3>
          <p>Installing from source requires Linux and has been tested
             only under Ubuntu 14.04 and 16.04.</p>
            <ol>

            <li>Install OCaml and OPAM:</li>
<pre><code class="language-bash">sudo apt-get update
sudo apt-get install -y python-software-properties build-essential m4
sudo add-apt-repository -y -u ppa:avsm/ppa
sudo apt-get install -y ocaml ocaml-native-compilers camlp4 camlp4-extra opam git libssl-dev aspcud
</code></pre>

          <li>Get the source code with vagrant scripts:</li>
<pre><code class="language-bash">git clone -b mc-decision https://github.com/frenetic-lang/frenetic.git</code></pre>

            <li>Copy the script from the `frenetic/vm` folder to the same folder containing the
              `frenetic` folder:
              <pre><code class="language-bash">cp frenetic/vm/*.sh .</code></pre>
          </li>
          <li>
              Then execute the following to automatically build McNetKAT,
              PRISM, Bayonet, and various dependencies.
<pre><code class="language-bash">bash setup-opam.sh
bash setup-ocaml.sh
bash setup-third-party.sh
bash setup-mcnetkat.sh
bash setup-prism-bayonet.sh
bash setup-plotlibs.sh
</code></pre>
          </li>
          </ol>
      </div>

<hr/>

<div id="results">
<h2>Replicating results</h2>

<div id="evaluation">
<h3>Evaluation</h3>
<!--  -->
  <h4>General Tips & Tricks</h4>
  <ol>
    <li>
      <strong>Log Files:</strong> The results of experiments are saved in
      individual <code>*.log</code> files, using one file per "data point".
      If a log file for a particular data point is already present, the experiment
      is <strong>skipped</strong>. To force the regeneration of a data point,
      either delete the corresponding log file or use the pattern
      <pre><code class="language-bash">F=1 ./run_bench.py</code></pre>
      When things go wrong, the log files can often give an indication why. 
    </li>
    <li>
      <strong>Timeouts:</strong>
      By default, the timeout for most experiments is set to 1 hour. You can
      also overwrite this default by specifying a timeout in seconds using the
      following pattern:
      <pre><code class="language-bash">TIMEOUT=60 ./run_bench.py</code></pre>
      This runs the benchmark with a timeout of 1 minute per data point.
    </li>
    <li>
      <strong>Orphan Processes:</strong>
      If you interrupt an experiment before it has completed, or it crashes, you
      may be left
      with orphan processes running in the background and draining CPU and memory
      resources. This will interfere with other experiments, so make sure to
      kill these orphan processes!
      
      The script <code>kill_all.sh</code> in
      the frenetic root folder can help with this, although you may have to
      adjust the parameters to your cluster (or comment out the cluster specific
      part, if you don't have a cluster).
      <strong>If your system appears unresponsive, this is likely the issue!</strong>
    </li>
    <li>
      <strong>Performance:</strong>
      One key feature of McNetKAT is that it parallelizes across all available
      cores. This leads to significant performance improvements,
      provided a large number of cores is available, and there is enough memory
      to afford parallelization. On a VM with limited memory, McNetKAT may run
      out of memory for larger experiments.
    </li>
  </ol>
<!--  -->
  <h4>Scalability on FatTree (Figure 7)</h4>
  <p>This experiment is run on a single machine.</p>
  <ol>
    <li>
      Navigate to the fattree/ecmp directory and delete old results:
      <pre><code class="language-bash">cd frenetic/experiments/fattree/ecmp
rm *.log</code></pre>
    </li>
    <li>
      Generate data points:
      <pre><code class="language-bash">./run_bench.py</code></pre>
    </li>
    <li>
      Plot result:
      <pre><code class="language-bash">./plot.py</code></pre>
    </li>
    <li>
      View result:
      <pre><code class="language-bash">xpdf ecmp.pdf
less ecmp.txt</code></pre>
    </li>
  </ol>
<!--  -->
  <h4>Parallel Speedup (Figure 8)</h4>
  <p>This experiment assumes a cluster of machines with 16 physical cores each.
    If no cluster is available, or the number of physical cores differs, the
    experiment may be reproduced partially, as detailed below.
  </p>
  <h5 id="cluster-setup"><strong>Setting up the cluster:</strong></h5>
  <p>
    The master machine
    (from which the experiment is run) must have access to the other machines
    using ssh via passwordless key authentication. 
    In particular, if <code>foo</code> is the hostname of a remote
    machine on the cluster, the following should succeed without the need to
    enter a passphrase, where
    <code>bar</code> is an appropriate user on the host <code>foo</code>:
    <pre><code class="language-bash">ssh bar@foo</code></pre>
    Instructions on how to achieve this can be found <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-ssh-keys-on-ubuntu-1604">here</a>.
  </p>
  <h5><strong>Running the experiment:</strong></h5>
  <ol>
    <li>
      Navigate to the fattree/speedup directory and delete old results:
      <pre><code class="language-bash">cd frenetic/experiments/fattree/speedup
rm *.log</code></pre>
    </li>
    <li>
      Adjust parameters to fit your setup:
      <pre><code class="language-bash">nano +11 ./run_bench.py</code></pre>
      The relevant parameters are the following:
      <ul>
        <li><strong>J:</strong> The number of processes to use on the local machine. Set this to a value no larger than the number of physical cores.</li>
        <li><strong>RN:</strong> The number of remote machines to use.</li>
        <li><strong>RJ:</strong> The number of processes per remote machine to use.
          As with <strong>J</strong>, ensure this number is no larger than the number of physical cores.</li>
      </ul>
      If you don't have a cluster available, simply comment out the lines in
      <code class="language-bash">run_bench.py</code> that have <strong>RN</strong>
      set to a value above 0 -- you can still evaluate the speedup on a single machine. 
    </li>
    <li>
      Optionally, if you have a cluster: Given remote machines
        <code>m1, m2, ..., mk</code>
      with users
        <code>u1, u2, ..., uk</code>,
      export your setup as follow:
      <pre><code class="language-bash">export CLUSTER="u1@m1 u2@m2 ... uk@mk"</code></pre>
    </li>
    <li>
      Optionally, adjust the parameter <code>k</code> of the FatTrees to use:
      <pre><code class="language-bash">nano +38 run_bench.py</code></pre>
      By default, the experiment is run with k=14 and k=16.
    </li>
    <li>
      Generate data points:
      <pre><code class="language-bash">./run_bench.py</code></pre>
    </li>
    <li>
      Plot result:
      <pre><code class="language-bash">./plot.py</code></pre>
    </li>
    <li>
      View result:
      <pre><code class="language-bash">xpdf speedup.pdf
less speedup.txt</code></pre>
    </li>
  </ol>
<!--  -->
  <h4>Comparision with other tools (Figure 10)</h4>
  <p>This experiment is mostly run on a single machine. A cluster is needed only
    to generate the green <code>PNK (cluster)</code> line from Figure 10.
  </p>
  <ol>
    <li>
      Navigate to bayonet experiment directory and delete old results:
      <pre><code class="language-bash">cd frenetic/examples/bayonet
rm *.log</code></pre>
    </li>
    <li>
      Generate input files for Bayonet and McNetKAT:
      <pre><code class="language-bash">./generate.py</code></pre>
      If this completes successfully, you should see various
      <code>*.dot</code> and <code>*.bayonet</code> files in the directory.
    </li>
    <li>
      Optionally, adjust the paramters with which to invoke the various tools in
      <code>run_bench.py</code>.
      In particular, if you don't have a cluster, comment out the line with
      <code>'RN': '24'</code> -- it instructs McNetKAT to spread the workload
      to 24 remote machines.
      <pre><code class="language-bash">nano +19 run_bench.py</code></pre>
      If you <strong>do</strong> have a cluster, follow the instructions on
      <a href="#cluster-setup">how to set up the cluster</a>.

    </li>
    <li>
      Generate data points:
      <pre><code class="language-bash">./run_bench.py</code></pre>
    </li>
    <li>
      Plot result:
      <pre><code class="language-bash">cd ~/frenetic/plots
./bayonet.py ../examples/bayonet
</code></pre>
    </li>
    <li>
      View result:
      <pre><code class="language-bash">xpdf bayonet.pdf
less bayonet.txt</code></pre>
    </li>
  </ol>
</div>
<!--  -->
<hr/>
<!--  -->
<div>
<h3 id="case-study">Case Study: Data Center Fault-Tolerance</h3>
<!--  -->
  <h4>Comparing resilience of routing schemes (Figure 11)</h4>
  <ol>
    <li>To perform the analysis corresponding to the
      case study show in Figure 11 of the paper, run
      the following from the <code>frenetic</code>
      directory:</li>
  <pre><code class="language-bash">probnetkat.compare</code></pre>
    <li>This will generate json files in
      <code>./examples/output/results/comparisons</code>
      directory with data for the two tables. For the
      case with <code>k</code> failures, see the file
      <code>k-1-16.json</code>. The field
      <code>resilience</code> in each file
      corresponds to the equivalence test with
      teleportation in Figure 11 (b).</li>

    <li> To generate the table, run:</li>
  <pre><code class="language-bash">sh ./plots/f10-tables.sh</code></pre>
  </ol>
<!--  -->
  <h4>Case study with unbounded failures (Figure 12)</h4>
  <ol>
    <li>To perform the analysis corresponding to the
    case study show in Figure 12 of the paper, run the
    following script from the <code>frenetic</code>
    directory:</li>
  <pre><code class="language-bash">sh ./experiments/f10/run-partial.sh</code></pre>

      <li>It may take up to 10 minutes to complete
      the experiments.</li>

      <li>To plot and visualize the results, perform
      the following:</li>

  <pre><code class="language-bash">sh ./plots/f10.sh
xpdf experiments/f10/[name].pdf  # [name] = cdf_tput_vs_hop_count-inf-1-4, expected_hops_vs_fail_prob-inf, tput_vs_fail_prob-inf</code></pre>
  </ol>
</div>

</div>
</article>
</div>
</body>
</html>


